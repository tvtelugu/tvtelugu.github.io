<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live Match Streams</title>
<style>
:root {
  --bg: #0b101b;
  --card: rgba(255, 255, 255, 0.05);
  --accent: #4facfe;
}
body {
  margin: 0;
  background-color: var(--bg);
  background: radial-gradient(circle at top, #1a2236 0%, #0b101b 100%);
  color: #fff;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  padding: 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.container { width: 100%; max-width: 500px; }
h1 { font-size: 20px; margin-bottom: 5px; text-align: center; }
.status-msg { color: #ff4d4d; text-align: center; margin-top: 20px; display: none; }
.retry-btn { 
    background: #444; color: white; border: none; padding: 8px 15px; 
    border-radius: 5px; margin-top: 10px; cursor: pointer; display: none;
}
.card {
  background: var(--card);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 12px;
  padding: 15px;
  margin-bottom: 12px;
  backdrop-filter: blur(10px);
}
.ch-name { font-weight: bold; font-size: 16px; margin-bottom: 4px; }
.ch-meta { font-size: 12px; color: #aaa; margin-bottom: 12px; }
.btns { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
button {
  padding: 10px 5px; border-radius: 8px; border: none;
  font-size: 12px; font-weight: 600; cursor: pointer; color: white;
}
.btn-ns { background: #e91e63; }
.btn-pf { background: #00bcd4; }
.btn-cp { background: #4caf50; }
</style>
</head>
<body>

<div class="container">
    <h1 id="title">Loading...</h1>
    <div id="status" class="status-msg">Failed to load streams.</div>
    <center><button id="retry" class="retry-btn" onclick="loadData()">Try Again</button></center>
    <div id="list"></div>
</div>

<script>
async function loadData() {
    const listDiv = document.getElementById('list');
    const titleEl = document.getElementById('title');
    const statusEl = document.getElementById('status');
    const retryBtn = document.getElementById('retry');

    // Reset UI
    listDiv.innerHTML = "";
    statusEl.style.display = "none";
    retryBtn.style.display = "none";
    titleEl.innerText = "Loading...";

    try {
        // Using corsproxy.io to ensure the fetch works even from local files
        const apiUrl = "https://pasteking.u0k.workers.dev/3qsxt.json";
        const proxyUrl = "https://corsproxy.io/?" + encodeURIComponent(apiUrl);
        
        const res = await fetch(proxyUrl);
        if (!res.ok) throw new Error("HTTP Error");
        const data = await res.json();

        titleEl.innerText = data.event.title;

        data.streams.forEach(s => {
            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = `
                <div class="ch-name">${s.channel} [${s.language}]</div>
                <div class="ch-meta">${s.quality} • ${s.format} • ${s.provider}</div>
                <div class="btns">
                    <button class="btn-ns" onclick="openPlayer('ns', '${s.url}')">NS Player</button>
                    <button class="btn-pf" onclick="openPlayer('playify', '${s.url}')">Playify</button>
                    <button class="btn-cp" onclick="copyUrl('${s.url}')">Copy</button>
                </div>
            `;
            listDiv.appendChild(div);
        });

    } catch (err) {
        console.error(err);
        titleEl.innerText = "Error";
        statusEl.style.display = "block";
        retryBtn.style.display = "inline-block";
    }
}

function openPlayer(type, url) {
    let pkg = type === 'ns' ? 'com.genuine.leone' : 'com.appnix.playify';
    // Use proper Intent URI construction
    window.location.href = `intent:${url}#Intent;package=${pkg};end`;
}

function copyUrl(url) {
    navigator.clipboard.writeText(url);
    alert("URL Copied!");
}

loadData();
</script>
</body>
</html>
